                                    <label for="bulk-personalization-group" class="form-label">Select Recipients *</label>
                                    <select class="form-select" id="bulk-personalization-group" onchange="app.personalizationManager.generateBulkPreview()">
                                        <option value="">Select contacts...</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="bulk-personalization-delay" class="form-label">Delay Between Messages (seconds)</label>
                                    <input type="number" class="form-control" id="bulk-personalization-delay" value="2" min="1" max="10">
                                    <small class="form-text text-muted">Delay to avoid being flagged as spam</small>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="bulk-personalization-message" class="form-label">Message Template *</label>
                            <textarea class="form-control" id="bulk-personalization-message" rows="4" placeholder="Hi {{name}}, we hope you're doing well at {{company}}!" oninput="app.personalizationManager.generateBulkPreview()" required></textarea>
                            <small class="form-text text-muted">Use {{name}}, {{company}}, {{email}} and other tokens for personalization</small>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Preview Limit</label>
                            <input type="number" class="form-control" id="bulk-preview-limit" value="3" min="1" max="10" onchange="app.personalizationManager.generateBulkPreview()">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Message Previews</label>
                            <div id="bulk-personalization-preview" class="p-3 bg-light border rounded" style="max-height: 400px; overflow-y: auto;">
                                <em class="text-muted">Select contacts and enter a message to see preview</em>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="app.personalizationManager.sendBulkPersonalized()">
                        <i class="bi bi-send-plus"></i> Send Bulk Messages
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Template Personalization Modal -->
    <div class="modal fade" id="template-personalization-modal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Use Template with Personalization</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Template</label>
                        <div class="p-2 bg-light border rounded">
                            <strong id="template-personalization-name">Template Name</strong>
                        </div>
                    </div>
                    <form id="template-personalization-form">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="template-personalization-contact" class="form-label">Select Contact</label>
                                    <select class="form-select" id="template-personalization-contact" onchange="app.personalizationManager.autoFillTemplateVariables()">
                                        <option value="">Manual entry</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="template-personalization-phone" class="form-label">Or enter phone number</label>
                                    <input type="tel" class="form-control" id="template-personalization-phone" placeholder="+1234567890">
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="template-personalization-content" class="form-label">Template Content</label>
                            <textarea class="form-control" id="template-personalization-content" rows="4" readonly></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Fill Variables</label>
                            <div id="template-variables-input">
                                <em class="text-muted">No variables found in this template</em>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Message Preview</label>
                            <div id="template-personalization-preview" class="p-2 bg-light border rounded">
                                <em class="text-muted">Fill variables to see preview</em>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="app.personalizationManager.sendTemplatePersonalized()">
                        <i class="bi bi-send"></i> Send Message
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Contact Import Modal -->
    <div class="modal fade" id="import-contacts-modal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Import Contacts from CSV</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="import-contacts-form" enctype="multipart/form-data">
                        <div class="mb-3">
                            <label for="import-csv-file" class="form-label">CSV File *</label>
                            <input type="file" class="form-control" id="import-csv-file" accept=".csv" required>
                            <small class="form-text text-muted">CSV should have columns: name, phone, email, company, tags</small>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">CSV Format Example:</label>
                            <pre class="bg-light p-2 rounded small"><code>name,phone,email,company,tags
John Doe,+1234567890,john@example.com,Acme Corp,client
Jane Smith,+0987654321,jane@company.com,Tech Inc,prospect</code></pre>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="overwrite-contacts">
                            <label class="form-check-label" for="overwrite-contacts">
                                Overwrite existing contacts with same phone number
                            </label>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="import-contacts-btn-modal">
                        <i class="bi bi-upload"></i> Import Contacts
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Group Form Modal -->
    <div class="modal fade" id="group-form-modal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="group-form-title">Create Group</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="group-form">
                        <input type="hidden" id="group-id">
                        <div class="mb-3">
                            <label for="group-name" class="form-label">Group Name *</label>
                            <input type="text" class="form-control" id="group-name" required>
                        </div>
                        <div class="mb-3">
                            <label for="group-description" class="form-label">Description</label>
                            <textarea class="form-control" id="group-description" rows="3" placeholder="Optional group description..."></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="group-tags" class="form-label">Tags</label>
                            <input type="text" class="form-control" id="group-tags" placeholder="marketing, newsletter, vip">
                            <small class="form-text text-muted">Separate multiple tags with commas</small>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Select Contacts</label>
                            <div id="group-contacts-selection" class="border rounded p-3" style="max-height: 200px; overflow-y: auto;">
                                <em class="text-muted">Loading contacts...</em>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="save-group-btn">
                        <i class="bi bi-check-circle"></i> Save Group
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="js/template-manager.js"></script>
    <script src="js/contact-manager.js"></script>
    <script src="js/personalization-manager.js"></script>
    <script src="js/app.js"></script>
</body>
</html>